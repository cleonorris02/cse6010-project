# DNA Hotspot Encryption (Preprocessed Strings)

This module encrypts preprocessed hotspot DNA strings using libsodium's XChaCha20 stream cipher while parallelising the workload across seven OpenMP threads. Instead of parsing the original hotspot blocks, it consumes a TSV export produced by `python/pre_two.py`, which already condenses hotspot regions into standalone DNA strings.

## Building

```bash
cd encryption_preprocessed
make
```

> **Note:** libsodium headers and libraries must be installed on your system. The provided Makefile links against OpenMP (`-fopenmp`) and libsodium (`-lsodium`).

## Usage

```bash
./dna_hotspot_encryptor \
  --input ../processed_data/snp_hotspots_strings.tsv \
  --key ../keys/xchacha20.key \
  --output encrypted_hotspots.tsv
```

* `--input` points to the TSV created by the preprocessing stage. The file must contain a header row. At minimum, one column with DNA strings is required (`hotspot_string`, `hotspot_sequence`, `sequence`, or `dna_string`). Optional columns such as `record_id`, `hotspot_positions`, or `reference` are used as metadata.
* `--key` specifies a file with a 256-bit key encoded as hexadecimal characters (64 hex characters).
* `--output` identifies the TSV that will receive the encrypted payload.
* `--threads` (optional) overrides the default of seven worker threads.

Each output row contains:

| Column | Description |
| ------ | ----------- |
| `record_id` | Identifier of the hotspot string. Auto-generated if not provided in the TSV. |
| `nonce_dna` | Encryption nonce encoded as a DNA string (A/C/G/T). |
| `ciphertext_dna` | Ciphertext encoded as a DNA string, ready for downstream embedding. |

## Data expectations

The TSV generated by `python/pre_two.py` resembles the following (tabs shown as `→`):

```
record_id→hotspot_positions→reference→hotspot_string
chr12_0001→265043,265075,265101→GGCATTAAGTCCCATAGGGGTATGCTTAACTTTTGAT→ACGTACGTACGTACGTACGTACGTACGTACGT
chr12_0002→506152,506172→CTCAGCGTCCCGCCCTTACACTCCCCCGCCCCTCCC→TGCATGCATGCATGCATGCATGCATGCATGCA
```

The encryptor incorporates hotspot positions and reference sequences into the plaintext when available, ensuring the encrypted payload contains the contextual metadata required for reconstruction.

## Parallel execution

The tool enforces seven OpenMP threads by default to satisfy the throughput requirements of the downstream pipeline. Adjust `--threads` only when necessary for benchmarking or alternative deployments.
